<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" href="css/ratchet.css" />
        <script src="js/rachet.js"></script>
        <script src="js/push.js"></script>

        <script type="text/javascript" charset="utf-8" src="cordova-2.2.0.js"></script>
        <script src="OCRPlugin.js" type="text/javascript"></script>
        <script type="text/javascript" charset="utf-8">
            
            var pictureSource;   // picture source
            var destinationType; // sets the format of returned value 
            
            // Wait for Cordova to connect with the device
            //
            document.addEventListener("deviceready",onDeviceReady,false);
            
            // Cordova is ready to be used!
            //
            function onDeviceReady() {
                pictureSource=navigator.camera.PictureSourceType;
                destinationType=navigator.camera.DestinationType;
            }
            
            
            // Called when a photo is successfully retrieved
            //
            function onPhotoURISuccess(imageURI) {
                
                
                callNativePlugin({url_imagen: imageURI});
                
                //show loading screen
                //navigator.notification.loadingStart();
            }
            
            // A button will call this function
            //
            function capturePhoto() {
                // Take picture using device camera and retrieve image as file uri string
                navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 100,
                                            destinationType: destinationType.FILE_URI });
            }
            
            // A button will call this function
            //
            function capturePhotoEdit() {
                // Take picture using device camera, allow edit, and retrieve image as base64-encoded string  
                navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50, allowEdit: true,
                                            destinationType: destinationType.FILE_URI });
            }
            
            // Called if something bad happens.
            // 
            function onFail(message) {
                alert('Failed because: ' + message);
            }
            
            function callNativePlugin( returnSuccess ) { 
                OCRPlugin.callNativeFunction( nativePluginResultHandler, nativePluginErrorHandler, returnSuccess ); 
            } 
            
            function nativePluginResultHandler (result) { 
                //stop loading screen
                //navigator.notification.loadingStop();

                var ocr_res = document.getElementById("ocr");
                ocr_res.innerHTML = result;
            } 
            
            function nativePluginErrorHandler (error) { 
                alert("error: "+error);
            }
        </script>

        <script type="text/javascript">     

            function loadHTML(node, url, timeout) {
                if (timeout == undefined)
                    timeout = 10000;

                var req = new XMLHttpRequest();
                var timer = setTimeout(function() {
                    try {
                        req.abort();
                    } catch(e) {}
                    navigator.notification.loadingStop();
                }, );

                req.onreadystatechange = function() {
                    if (req.readyState == 4) {
                        if (req.status < 300) {
                            clearTimeout(timer);

                            var html = req.responseText;
                            html.replace(/.*<body>/, '');
                            html.replace(/<\/body>.*/, '');

                            node.innerHTML = html;
                        }
                        navigator.notification.loadingStop();
                        delete req;
                        delete node;
                    }
                };
                req.open('GET', url, true);
                req.send();
            }
            function getData(){
                loadHTML(document.getElementById("content"), 'www.google.com', 3000);
            }

        </script>
    </head>

    <body>
        <!-Title Bar->
        <header class="bar-title">
            <h1 class="title">Picture This</h1>
        </header>

        <!-Footer Bar-> 
        <nav class="bar-tab">
          <ul class="tab-inner">
            <li class="tab-item active">
              <a href="camera.html" data-ajax="false" data-transition="slide-in">
                <img class="tab-icon" src="img/camera.png">
                <div class="tab-label">Camera</div>
              </a>
            </li>
            <li class="tab-item">
              <a href="index.html"  data-ajax="false" data-transition="slide-in">
                <img class="tab-icon" src="img/search.png">
                <div class="tab-label">Search</div>
              </a>
            </li>
            <li class="tab-item">
              <a href="">
                <img class="tab-icon" src="img/settings.png">
                <div class="tab-label">Settings</div>
              </a>
            </li>
          </ul>
        </nav>
        <div id="home" class="content">
            <button onclick="capturePhotoEdit();">Take Photo</button>
            <p id='ocr'></p>

            <br><br>
            <button onclick="getData();">Take Photo</button>
            <div id="content">
            </div>
        </div>
    </body>
</html>